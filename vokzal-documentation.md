# Система оповещения пассажиров объектов транспортной инфраструктуры с использованием визуальных, звуковых и индивидуальных каналов связи
___
# Постановка задачи
Разработать систему, обеспечивающую:
* Получение из внешних источников информации, которую нужно передать пассажирам объектов
  транспортной инфраструктуры, подключенных к системе.
* Редактирование переданной и создание новой информации такого типа пользователями
  с разными уровнями прав доступа.
* Хранение этой и прочей информации, необходимой для корректной работы системы.
* Логирование действий пользователей.
* Форматирование информации в тот вид, который будет удобен для ее передачи на внешние устройства,
  оповещающие пассажиров.
* Передачу информации на эти устройства во время, указанное пользователем или максимально близкое
  к нему.
* Удобное использование. Визуальный интерфейс системы должен представлять собой диспетчерский терминал.
 Необходимо учесть, что пользователь будет работать долгое время без перерывов, поэтому
  следует снизить зрительную нагрузку - сделать интерфейс понятным, не перегруженным, с мягкой
  цветовой гаммой, акцентирующей важные детали интерфейса.

Основными требованиями к системе являются быстродействие, отказоустойчивость, возможность расширения,
модульность и гибкость.

Система должна быть построена на клиент-серверной архитектуре.

# Средства реализации
## Средства реализации серверной части
* Java development kit 17
* Spring Framework 5.3
* Spring Boot 2.6
* Maven 3.8

## Средства реализации клиентской части
* Html 5
* Css 3
* JavaScript (ECMAScript 6)
* Node JS
* React JS
* Chromium
* Electron

# Проектирование
## Основные понятия, используемые в системе
* Событие - ситуация во внешней среде, о которой нужно проинформировать.
События делятся на типы. Когда событие происходит его тип и информация о нем передается внешним источником в систему.
* Шаблон события - файл, в который подставляется, передаваемая с типом события. Для большинства типов события задан шаблон.
* Контент - аудио-, видео- или текстовый файл.
* Плейлист - отсортированный список пронумерованного контента, публикуемый и исполняемый целиком.
* Действие - операция, совершаемая при обработке события.
* Сценарий - последовательность действий.
* Публикация - совокупность контента и информации о том, как его публиковать
(приоритет публикации, какая система ее создала, кому она адресована, в какое время планируем ее воспроизвести,
в какое время она была воспроизведена, длительность, статус).
* План публикации - алгоритм, описывающий сколько раз, в течении какого отрезка времени нужно повторять публикацию.
* Получатель - человек, которого нужно проинформировать о событии или показать ему контент.
* Группа получателей - получатели, объединенные по какому-либо общему признаку. Например, пассажиры одного рейса.

## Основные компоненты системы
* Шлюз событий. Получает из внешней системы тип и информацию о событии, преобразует в формат понятный
  Системе обработки событий и передает системе.
* Хранилище контента – область памяти, предназначенная для хранения объемных файлов.
* База данных.
* Система обработки событий (СОС). Управляет созданием контента по шаблонам, на основе типа и информации о событии.
 Позволяет создавать и редактировать шаблоны, хранит шаблоны и их связи с событиями. На основе сценария создает публикации
  и записывает их в базу данных.
* Система формирования плейлистов вручную/автоматически (ручная/автоматическая СФП). Позволяет создавать и редактировать
  контент, плейлисты и планы публикаций.
* Система управления исполнением (СУИ). Делает выборку публикаций из базы данных, основываясь на приоритете и времени.
 На основе этой выборки сигнализирует шлюзу исполнения о том, что нужно показать тот или иной контент,
  передает шлюзу сам контент или ссылку на него.
* Шлюз исполнения. Забирает контент из хранилища, если необходимо форматирует и передает исполнителю.
* Исполнитель - внешние устройство, показывающее контент пассажирам. Исполнитель имеет один и более каналов для показа контента.


  ![](pictures/skhema_vzaimodeystvia_componentov.png "Схема взаимодействия компонентов")
  
## Общая архитектура серверной части
Основными классами являются контроллеры, сервисы, репозитории и модели.
* Контроллеры получают данные от клиента, преобразуют их в формат, с которым работает система и наоборот. 
Для обмена информацией с клиентом используются http-запросы с json в теле запроса.
* В сервисе происходит преобразование информации из вида, в котором она хранится в базе, в вид, который используется
для общения с клиентом и наоборот. Так же осуществляется проверка и модификация информации (бизнес-логика).
* Репозиторий осуществляет запросы к базе данных, находит, добавляет, обновляет и удаляет информацию в ней.
* Модель – класс нужный для передачи информации между сервисом, контроллером и репозиторием.


![](pictures/componenti_servernoy_chasti.png "Схема взаимодействия компонентов серверной части")

### Схема базы данных
Основной сущностью в базе данных является публикация. Она имеет следующие поля:
* ID
* ID системы (СОС или СФП), создавшей запись в таблице "Публикация".
* ID приоритета. Приоритет показывает насколько важно показать пассажирам контент из публикации
* ID канала. В таблице "Исполнитель" хранится информация об устройстве, на которое передается контент.
Устройство может иметь несколько каналов вывода (например, динамик с разными каналами). В таблице "Канал"
хранится информация о каналах, на которые посылается публикация.
* ID получателя. Указывается при отправке публикации СМС-сообщением или на почту.
* ID контента, который будет показан пассажирам.
* ID плана публикации, в соответствии с которым публикация была создана.
* Планируемое время воспроизведения публикации.
* Фактическое время воспроизведения публикации.
* Статус публикации

В базе данных плейлист хранится как контент, в который вложен другой контент. То есть если поле ID в таблице 
"Контент" связано с полем ID плейлиста в таблице "Плейлист", то этот контент является плейлистом. Если поле ID в таблице
"Контент" связано с полем ID контента в таблице "Плейлист", то этот контент входит в плейлист, ID которого записано в 
поле ID плейлиста, порядковый номер этого контента в плейлисте записан в поле Порядковый номер.


Аналогично, группа получателей является получателем, содержащим других получателей.


![](pictures/baza_dannih.png "Схема базы данных")